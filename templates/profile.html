{% extends "layout.html" %}

{% block title %}User Profile - My Website{% endblock %}

{% block content %}
<div class="container">
    <div class="register-container mx-auto">
        <h3 class="text-center mb-4">My Profile</h3>
        <form action="/profile" method="POST">
            <!-- Existing fields -->
            <div class="mb-3">
                <label for="username" class="form-label">Username </label>
                <input type="text" class="form-control" id="username" name="username" 
                       value="{{ username | default('') }}" required>
            </div>

            <div class="mb-3">
                <label for="name" class="form-label">Full Name</label>
                <input type="text" class="form-control" id="name" name="name" 
                       value="{{ name | default('') }}" required>
            </div>

            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" name="email" 
                       value="{{ email | default('') }}" required>
            </div>

            <div class="mb-3">
                <label for="phone" class="form-label">Phone</label>
                <input type="tel" class="form-control" id="phone" name="phone" 
                       value="{{ phone | default('') }}">
            </div>

            <!-- DID Field with Copy Icon -->
            <div class="mb-3">
                <div class="d-flex justify-content-between">
                    <label for="did" class="form-label mb-0">DID</label>

                    <!-- Tooltip or Message (optional, shown when DID is copied) -->
                    <div id="copyTooltip" class="tooltip-message" style="display:none; margin-left: 10px; color: green;">
                        DID copied!
                    </div>
                </div>

                <div class="input-group mt-2">
                    <input type="text" class="form-control" id="did" value="" name="did" readonly
                           style="background-color: #e9ecef; color: #6c757d;">
                    <!-- Add Copy Icon (Only show if there's a value in the DID field) -->
                    <span id="copyIcon" class="input-group-text" style="cursor: pointer;" data-toggle="tooltip" data-placement="top" title="Copy">
                        <i id="copyIconClass" class="bi bi-clipboard"></i> <!-- bi-clipboard icon -->
                    </span>
                </div>

                <!-- Create DID Link (Visible only if DID is empty) -->
                <div id="createDidLinkContainer" style="display: none;">
                    <a href="/did" id="createDidLink" class="d-block mt-2 text-primary">Create DID</a>
                </div>
            </div>

            <div class="text-center">
                <button type="submit" class="btn btn-primary w-100">Submit</button>
            </div>
        </form>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.9.1/font/bootstrap-icons.min.css"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>

<script>
$(document).ready(function() {
    // Enable tooltips for Bootstrap icons
    $('[data-toggle="tooltip"]').tooltip();

    // Cache elements for performance
    const $didField = $('#did');
    const $copyIcon = $('#copyIcon');
    const $copyIconClass = $('#copyIconClass');
    const $createDidLinkContainer = $('#createDidLinkContainer');
    const $copyTooltip = $('#copyTooltip');

    // Get the value of the DID field
    const didValue = $didField.val();

    // Show the Copy icon and Hide the Create DID link based on the DID field value
    if (didValue) {
        $copyIcon.show();
        $createDidLinkContainer.hide();

        // Handle Copy icon click event
        $copyIcon.on('click', function() {
            const textToCopy = didValue; // Use the existing value of the DID field

            // Change the icon to a tick mark when clicked
            $copyIconClass.removeClass('bi bi-clipboard').addClass('bi-check-circle');

            // Use the Clipboard API to copy the text
            navigator.clipboard.writeText(textToCopy)
                .then(function() {
                    // Show the tooltip with a fade-in effect
                    $copyTooltip.stop(true, true).text('Copied!').fadeIn().delay(2000).fadeOut();
                })
                .catch(function(error) {
                    alert('Failed to copy text: ' + error);
                });

            // Reset the icon after a delay
            setTimeout(() => {
                $copyIconClass.removeClass('bi-check-circle').addClass('bi bi-clipboard');
            }, 2000);
        });
    } else {
        // Hide the Copy icon and show the Create DID link if DID is empty
        $copyIcon.hide();
        $createDidLinkContainer.show();
    }
});

</script>

{% endblock %}
