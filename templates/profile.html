{% extends "layout.html" %}

{% block title %}User Profile - My Website{% endblock %}

{% block content %}
<div class="container">
    <div class="register-container mx-auto">
        <h3 class="text-center mb-4">My Profile</h3>
        <form action="/profile" method="POST">
            <!-- Existing fields -->
            <div class="mb-3">
                <label for="username" class="form-label">Username </label>
                <input type="text" class="form-control" id="username" name="username" 
                       value="{{ user.username | default('') }}" required>
            </div>

            <div class="mb-3">
                <label for="name" class="form-label">Full Name</label>
                <input type="text" class="form-control" id="name" name="name" 
                       value="{{ user.name | default('') }}" required>
            </div>

            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" name="email" 
                value="{{ user.email | default('') }}" required>
            </div>

            <div class="mb-3">
                <label for="phone" class="form-label">Phone</label>
                <input type="tel" class="form-control" id="phone" name="phone" 
                       value="{{ user.phone | default('') }}">
            </div>

             <!-- Wallet Field with Copy Icon -->
             <div class="mb-3">
                <div class="d-flex justify-content-between">
                    <label for="wallet" class="form-label mb-0">Wallet</label>

                    <!-- Tooltip or Message (optional, shown when Wallet is copied) -->
                    <div id="walletCopyTooltip" class="tooltip-message" style="display:none; margin-left: 10px; color: green;">
                        Wallet copied!
                    </div>
                </div>

                <div class="input-group mt-2">
                    <input type="text" class="form-control" id="wallet" value="" name="wallet" readonly
                           style="background-color: #e9ecef; color: #6c757d;">
                    <!-- Add Copy Icon (Only show if there's a value in the Wallet field) -->
                    <span id="walletCopyIcon" class="input-group-text" style="cursor: pointer;" data-toggle="tooltip" data-placement="top" title="Copy">
                        <i id="walletCopyIconClass" class="bi bi-clipboard"></i> <!-- bi-clipboard icon -->
                    </span>
                </div>

                <!-- Create Wallet Link (Visible only if Wallet is empty) -->
                <div id="createWalletLinkContainer" style="display: none;">
                    <a href="/wallet" id="createWalletLink" class="d-block mt-2 text-primary">Create Wallet</a>
                </div>
                <a   id="createWalletLink" class="d-block mt-2 text-primary">CreateWallet </a>
            </div>


            <!-- DID Field with Copy Icon -->
            <div class="mb-3">
                <div class="d-flex justify-content-between">
                    <label for="did" class="form-label mb-0">DID</label>

                    <!-- Tooltip or Message (optional, shown when DID is copied) -->
                    <div id="copyTooltip" class="tooltip-message" style="display:none; margin-left: 10px; color: green;">
                        DID copied!
                    </div>
                </div>

                <div class="input-group mt-2">
                    <input type="text" class="form-control" id="did" value="" name="did" readonly
                           style="background-color: #e9ecef; color: #6c757d;">
                    <!-- Add Copy Icon (Only show if there's a value in the DID field) -->
                    <span id="copyIcon" class="input-group-text" style="cursor: pointer;" data-toggle="tooltip" data-placement="top" title="Copy">
                        <i id="copyIconClass" class="bi bi-clipboard"></i> <!-- bi-clipboard icon -->
                    </span>
                </div>

                <!-- Create DID Link (Visible only if DID is empty) -->
                <div id="createDidLinkContainer" style="display: none;">
                    <a href="/did" id="createDidLink" class="d-block mt-2 text-primary">Create DID</a>
                </div>
            </div>

           
            <div class="text-center">
                <button type="submit" class="btn btn-primary w-100">Submit</button>
            </div>
        </form>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.9.1/font/bootstrap-icons.min.css"></script> -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.9.1/font/bootstrap-icons.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>

<script>




$(document).ready(function() {
    // Enable tooltips for Bootstrap icons
    $('[data-toggle="tooltip"]').tooltip();

    // Cache selectors to avoid repeated DOM queries
    const $didField = $('#did');
    const $walletField = $('#wallet');
    const $createDidLinkContainer = $('#createDidLinkContainer');
    const $createWalletLinkContainer = $('#createWalletLinkContainer');
    const $copyIcon = $('#copyIcon');
    const $walletCopyIcon = $('#walletCopyIcon');

    // Show/hide Copy icons and Create links based on input values at page load
    toggleFieldVisibility($didField, $copyIcon, $createDidLinkContainer);
    toggleFieldVisibility($walletField, $walletCopyIcon, $createWalletLinkContainer);
    
    // Unified click event handler using delegation for Copy Icon
    $(document).on('click', '.input-group-text', function() {
        const $iconClass = $(this).find('i');
        const $inputField = $(this).siblings('input');
        const fieldValue = $inputField.val();
        const tooltip = $(this).siblings('.tooltip-message');

        // Copy only if field has a value
        if (fieldValue) {
            $iconClass.removeClass('bi-clipboard').addClass('bi-check-circle'); // Change icon to check-circle
            navigator.clipboard.writeText(fieldValue).then(() => {
                tooltip.stop(true, true).fadeIn().text('Copied!').delay(2000).fadeOut(); // Show tooltip
                setTimeout(() => $iconClass.removeClass('bi-check-circle').addClass('bi-clipboard'), 2000); // Reset icon after 2 seconds
            }).catch(err => console.error('Copy failed:', err)); // Handle any copy errors
        }
    });

    // Toggle visibility of Create DID and Create Wallet links based on Wallet value
    $walletField.on('input', toggleVisibilityBasedOnWallet);

    // Helper functions
    // Toggle visibility of Copy icons and Create Links (DID or Wallet)
    function toggleFieldVisibility($field, $copyIcon, $createLink) {
        const hasValue = $field.val();
        $copyIcon.toggle(!!hasValue);  // Show copy icon if value exists
        $createLink.toggle(!hasValue); // Show Create link if no value
    }

    // Toggle visibility of Create DID and Create Wallet links based on Wallet value
    function toggleVisibilityBasedOnWallet() {
        const walletHasValue = !!$walletField.val();  // Check if Wallet field has a value
        const didHasValue = !!$didField.val(); // Check if DID field has a value

        $didField.closest('.mb-3').show(); // DID field is always visible
        $createDidLinkContainer.toggle(walletHasValue && !didHasValue); // Show Create DID link only if Wallet has a value and DID is empty
        $createWalletLinkContainer.toggle(!walletHasValue); // Show Create Wallet link only if Wallet is empty
    }

    // Initial check to hide/show Create DID and Create Wallet links based on Wallet field value
    toggleVisibilityBasedOnWallet();
});


</script>

{% endblock %}
